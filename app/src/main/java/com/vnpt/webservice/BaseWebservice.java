package com.vnpt.webservice;

import android.util.Log;

import com.google.gson.Gson;
import com.google.gson.GsonBuilder;
import com.vnpt.common.Common;
import com.vnpt.utils.Helper;

import org.apache.http.HttpEntity;
import org.apache.http.HttpResponse;
import org.apache.http.HttpVersion;
import org.apache.http.NameValuePair;
import org.apache.http.client.HttpClient;
import org.apache.http.client.entity.UrlEncodedFormEntity;
import org.apache.http.client.methods.HttpGet;
import org.apache.http.client.methods.HttpPost;
import org.apache.http.conn.ClientConnectionManager;
import org.apache.http.conn.scheme.PlainSocketFactory;
import org.apache.http.conn.scheme.Scheme;
import org.apache.http.conn.scheme.SchemeRegistry;
import org.apache.http.conn.ssl.SSLSocketFactory;
import org.apache.http.entity.StringEntity;
import org.apache.http.entity.mime.MultipartEntity;
import org.apache.http.impl.client.DefaultHttpClient;
import org.apache.http.impl.conn.tsccm.ThreadSafeClientConnManager;
import org.apache.http.params.BasicHttpParams;
import org.apache.http.params.CoreProtocolPNames;
import org.apache.http.params.HttpConnectionParams;
import org.apache.http.params.HttpParams;
import org.apache.http.params.HttpProtocolParams;
import org.apache.http.protocol.HTTP;
import org.apache.http.util.EntityUtils;
import org.json.JSONArray;
import org.json.JSONObject;

import java.io.DataOutputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.InputStream;
import java.net.HttpURLConnection;
import java.net.URI;
import java.net.URL;
import java.security.KeyStore;
import java.util.ArrayList;
import java.util.List;


public abstract class BaseWebservice {

    private static final String TAG = "BaseWebservice";
    public static final int TIME_OUT = 5000;
//    public static final String URL_SERVER = "http://hcmlottehotelapi.vscmt.vn";
//    public static final String URL_SERVER = "http://metropolehanoi.vscmt.vn";
//    public static final String URL_SERVER = "http://localhost:8080/bntt/";
//    public static final String URL_SERVER = "http://api.metropole.e-invoicing.vn";
//    public static final String URL_SERVER = "http://172.21.105.179";//soÌ€fitel
    public static final String URL_SERVER = "http://101.96.76.185";


    public static final String USER_API_LOGIN = "/api/user/login";
    public static final String USER_API_INFOR = "/api/user/infor-user";
    public static final String USER_API_UPDATE_SIGNED_MOBILE = "/api/invoice/UpdateSignedMobile";
    public static final String INVOICE_API_LIST_INVOICE_BY_USER = "/api/Portal/GetListInvoicesStatus";
    public static final String INVOICE_API_LIST_INVOICE_BY_DATE = "/api/Portal/GetFullListInvoicesByDate";
    public static final String INVOICE_API_LIST_INVOICE_SIGN_BY_DATE = "/api/Portal/GetFullListInvoicesSignByDate";

    public static final String INVOICE_API_LIST_INVOICE_UPLOAD_FILE= "/api/invoice/UpdateImageMobile";
    public static final String INVOICE_API_LIST_OUTLET_NAME= "/api/Portal/GetListOutletName";

//    public static final String INVOICE_API_LIST_INVOICE_BY_USER = "getInvoiceByUser";
    public static final String INVOICE_API_DETAIL_INVOICE_BY_USER = "getDetailsInvoiceByCustomer";
    public static final String INVOICE_API_GET_ALL_TERM = "getAllTermInvoice";

    public static final String INVOICE_API_UPDATE_STATUS_PAYMENTED_INVOICE = "updateStatusPaymentedInvoice";
    public static final String INVOICE_API_LIST_INVOICE_HISTORY = "listInvoiceHistoryByIdCustomer";
    public static final String INVOICE_API_UPDATE_STATUS_RETURN_INVOICE = "updateStatusPaymentedToNotPaymentInvoice";

    public static String authorizationString = "";

//	public static void changeServerPath(String newServerPath){
//		ApplicationConfig.SERVER = newServerPath;
//		ApplicationConfig.VIRTUAL_HOST = ApplicationConfig.SERVER;
//		if(ApplicationConfig.VIRTUAL_HOST.contains("http"))
//			ApplicationConfig.VIRTUAL_HOST.replace("http://", "");
//	}

    public static void init() {
        Common.AUTHORIZE_STRING = Helper.getB64Auth();
    }
    int serverResponseCode = 0;
    String upLoadServerUri = null;

    /**********  File Path *************/
    final String uploadFilePath = "/mnt/sdcard/";
    public BaseWebservice() {
        //Authorization user and pass admin
        Common.AUTHORIZE_STRING = Helper.getB64Auth();
        Log.e(TAG, Common.AUTHORIZE_STRING + "");
    }

    public String getWSAsString(String wsUrl, String errorLog) {
        String ret = null;
        HttpClient client = new DefaultHttpClient();
        wsUrl = wsUrl.replace(" ", "%20");
        System.out.println("getWSAsString:" + wsUrl);
        try {
            HttpPost post = new HttpPost(wsUrl);
            post.setHeader("Authorization", Common.AUTHORIZE_STRING);
            HttpResponse response = client.execute(post);
            HttpEntity entity = response.getEntity();
            if (entity != null) {
                InputStream is = entity.getContent();
                ret = Helper.toString(is).trim();
            }
        } catch (Exception ex) {
            Log.e(TAG, errorLog);
            ex.printStackTrace();
        }
        return ret;
    }

    /**
     * get Service from Server
     *
     * @param wsUrl
     * @param errorLog
     *
     * @return
     */
    protected JSONArray doGet(String wsUrl, String errorLog) {
        JSONArray ret = null;
        HttpClient client = new DefaultHttpClient();
        wsUrl = wsUrl.replace(" ", "%20");
        System.out.println("doGet:::" + wsUrl);
        try {
//            HttpGet post = new HttpGet(wsUrl);
            HttpGet request = new HttpGet();
            URI website = new URI(wsUrl);
            request.setURI(website);
//            post.setHeader("Authorization", Common.AUTHORIZE_STRING);
            HttpResponse response = client.execute(request);
            HttpEntity entity = response.getEntity();
            if (entity != null) {
                InputStream is = entity.getContent();
                String str = Helper.toString(is);
                ret = new JSONArray(str);
            }
            System.out.println("doGet:Result::" + ret.toString());
        } catch (Exception ex) {
            Log.e(TAG, errorLog+":"+ex);
        }
        return ret;
    }
    protected JSONObject doGetJSObject(String wsUrl, String errorLog) {
        JSONObject ret = null;
        HttpClient client = new DefaultHttpClient();
        wsUrl = wsUrl.replace(" ", "%20");
        System.out.println("doGet:::" + wsUrl);
        try {
//            HttpGet post = new HttpGet(wsUrl);
            HttpGet request = new HttpGet();
            URI website = new URI(wsUrl);
            request.setURI(website);
//            post.setHeader("Authorization", Common.AUTHORIZE_STRING);
            HttpResponse response = client.execute(request);
            HttpEntity entity = response.getEntity();
            if (entity != null) {
                InputStream is = entity.getContent();
                String str = Helper.toString(is);
                ret = new JSONObject(str);
            }
            System.out.println("doGet:Result::" + ret.toString());
        } catch (Exception ex) {
            Log.e(TAG, errorLog+":"+ex);
        }
        return ret;
    }
    /**
     * get Service from Server
     *
     * @param wsUrl
     * @param errorLog
     *
     * @return
     */
    protected JSONArray doGetMetro(String wsUrl, String errorLog) {
        JSONArray reta = null;
        JSONObject ret = null;
        BasicHttpParams httpParams = new BasicHttpParams();
        //this will set socket timeout
        HttpConnectionParams.setSoTimeout(httpParams, /*say*/ TIME_OUT);
        //this will set connection timeout
        HttpConnectionParams.setConnectionTimeout(httpParams, TIME_OUT);
        HttpClient client = new DefaultHttpClient(httpParams);
        wsUrl = wsUrl.replace(" ", "%20");
        System.out.println("doGet:::" + wsUrl);
        try {
//            HttpGet post = new HttpGet(wsUrl);
            HttpGet request = new HttpGet();
            URI website = new URI(wsUrl);
            request.setURI(website);
//            post.setHeader("Authorization", Common.AUTHORIZE_STRING);
            HttpResponse response = client.execute(request);
            HttpEntity entity = response.getEntity();
            if (entity != null) {
                InputStream is = entity.getContent();
                String str = Helper.toString(is);
                reta = new JSONArray(str);
                System.out.println("doGet:Result::" + str);
            }

        } catch (Exception ex) {
            Log.e(TAG, errorLog+":"+ex);
        }
        return reta;
    }
    protected JSONArray doGetJSONArrayPost(String wsUrl, String errorLog, List<NameValuePair> listParams) {
        JSONArray ret = null;
        HttpClient client = new DefaultHttpClient();
        wsUrl = wsUrl.replace(" ", "%20");
        System.out.println("doPost:::" + wsUrl);
        try {
            HttpPost post = new HttpPost(wsUrl);
            post.setHeader("Authorization", Common.AUTHORIZE_STRING);
            post.setEntity(new UrlEncodedFormEntity(listParams));
            HttpResponse response = client.execute(post);
            HttpEntity entity = response.getEntity();
            if (entity != null) {
                InputStream is = entity.getContent();
                String str = Helper.toString(is);
                ret = new JSONArray(str);
            }
        } catch (Exception ex) {
            Log.e(TAG, errorLog);
            ex.printStackTrace();
        }
        return ret;
    }

    protected JSONArray doGetJSONArrayPostUTF_8(String wsUrl, String errorLog, List<NameValuePair> listParams) {
        JSONArray ret = null;
        HttpParams params = new BasicHttpParams();
        HttpProtocolParams.setVersion(params, HttpVersion.HTTP_1_1);
        HttpProtocolParams.setContentCharset(params, "UTF-8");
        params.setBooleanParameter("http.protocol.expect-continue", false);
        HttpClient client = new DefaultHttpClient(params);
        wsUrl = wsUrl.replace(" ", "%20");
        System.out.println("doPost:::" + wsUrl);
        try {
            HttpPost post = new HttpPost(wsUrl);
//            post.setHeader("Authorization", Common.AUTHORIZE_STRING);
//            post.setEntity(new UrlEncodedFormEntity(listParams));
            HttpResponse response = client.execute(post);
            HttpEntity entity = response.getEntity();
            if (entity != null) {
                /*InputStream is = entity.getContent();
                String str = Helper.toString(is);*/
                String str = EntityUtils.toString(entity, HTTP.UTF_8);
                ret = new JSONArray(str);
            }
        } catch (Exception ex) {
            Log.e(TAG, errorLog);
            ex.printStackTrace();
        }
        return ret;
    }

    public JSONObject doGetJSONObj(String wsUrl, String errorLog) {
        JSONObject ret = null;
        HttpClient client = new DefaultHttpClient();
        wsUrl = wsUrl.replace(" ", "%20");
        System.out.println("doGetJSONObj" + wsUrl);
        try {
            HttpPost post = new HttpPost(wsUrl);
            post.setHeader("Authorization", Common.AUTHORIZE_STRING);
            HttpResponse response = client.execute(post);
            HttpEntity entity = response.getEntity();
            if (entity != null) {
                InputStream is = entity.getContent();
                String str = Helper.toString(is);

                ret = new JSONObject(str);
            }
        } catch (Exception ex) {
            Log.e(TAG, errorLog);
            ex.printStackTrace();
        }
        return ret;
    }

    public JSONObject doGetJSONObjPOST(String wsUrl, String errorLog, List<NameValuePair> nameValuePairs) {
        JSONObject ret = null;
        HttpClient client = getNewHttpClient();
        wsUrl = wsUrl.replace(" ", "%20");
        try {
            HttpPost post = new HttpPost(wsUrl);
            post.setHeader("Authorization", Common.AUTHORIZE_STRING);
            post.setHeader("Content-Type", "application/x-www-form-urlencoded");
            post.setEntity(new UrlEncodedFormEntity(nameValuePairs));

            HttpResponse response = client.execute(post);
            HttpEntity entity = response.getEntity();
            if (entity != null) {
                InputStream is = entity.getContent();
                String str = Helper.toString(is).trim();
                System.out.println("chuoi str:" + str);
                ret = new JSONObject(str);
                is.close();
            }
        } catch (Exception ex) {
            Log.e(TAG, errorLog);
            ex.printStackTrace();
        }
        return ret;
    }

    public long doGetJSONObjPOST(String wsUrl, String errorLog, MultipartEntity nameValuePairs) {
        long ret = 0;
        HttpParams params = new BasicHttpParams();
        params.setParameter(CoreProtocolPNames.PROTOCOL_VERSION, HttpVersion.HTTP_1_1);
        HttpClient client = new DefaultHttpClient(params);
        System.out.println("WsURl:" + wsUrl);
        try {
            HttpPost post = new HttpPost(wsUrl);
//            post.setHeader("Authorization", Common.AUTHORIZE_STRING);
            post.setEntity(nameValuePairs);

            HttpResponse response = client.execute(post);
            HttpEntity entity = response.getEntity();
            if (entity != null) {
                InputStream is = entity.getContent();
                String str = Helper.toString(is).trim();
//                ret = Long.parseLong(str);
                System.out.println(str);
            }
            client.getConnectionManager().shutdown();
        } catch (Exception ex) {
            Log.e(TAG, errorLog);
            ex.printStackTrace();
        }
        return ret;
    }

    public boolean doBooleanPOST(String wsUrl, String errorLog, List<NameValuePair> nameValuePairs) {
        boolean ret = false;
        HttpClient client = new DefaultHttpClient();
        try {
            HttpPost post = new HttpPost(wsUrl);
            post.setHeader("Authorization", Common.AUTHORIZE_STRING);

            post.setEntity(new UrlEncodedFormEntity(nameValuePairs));

            HttpResponse response = client.execute(post);
            HttpEntity entity = response.getEntity();
            if (entity != null) {
                InputStream is = entity.getContent();
                String str = Helper.toString(is).trim();
                if (str.equals("true"))
                    ret = true;
            }
        } catch (Exception ex) {
            Log.e(TAG, errorLog);
            ex.printStackTrace();
        }
        return ret;
    }


    public JSONObject doGetNotAuth(String wsUrl, String errorLog) {
        JSONObject ret = null;
        HttpClient client = new DefaultHttpClient();
        wsUrl = wsUrl.replace(" ", "%20");
        System.out.println("doGetJSONObj" + wsUrl);
        try {
            HttpPost post = new HttpPost(wsUrl);
            HttpResponse response = client.execute(post);
            HttpEntity entity = response.getEntity();
            if (entity != null) {
                InputStream is = entity.getContent();
                String str = Helper.toString(is);

                ret = new JSONObject(str);
            }
        } catch (Exception ex) {

            Log.e(TAG, errorLog);
        }
        return ret;
    }

    /**
     * parse JSONArray to ArrayList<ArrayList<String>>
     *
     * @param jArr
     * @param params
     *
     * @return
     */
    public ArrayList<ArrayList<String>> jsonArrTo2DimenArrayList(JSONArray jArr, String[] params) {
        ArrayList<ArrayList<String>> ret = null;
        if (jArr != null) {
            try {
                ret = new ArrayList<ArrayList<String>>();
                int count = jArr.length();
                for (int i = 0; i < count; i++) {
                    ArrayList<String> item = new ArrayList<String>();
                    JSONObject obj = jArr.getJSONObject(i);
                    for (String iter : params) {
                        item.add(obj.getString(iter));
                    }
                    ret.add(item);
                }
            } catch (Exception ex) {
                ex.printStackTrace();
            }
        }
        return ret;
    }

    /**
     * parse JSONArray to ArrayList<ArrayList<String>>
     * print errorLog when error occur.
     *
     * @param jArr
     * @param params
     * @param errorLog
     *
     * @return
     */
    public ArrayList<ArrayList<String>> jsonArrTo2DimenArrayList(JSONArray jArr, String[] params, String errorLog) {
        ArrayList<ArrayList<String>> ret = null;
        if (jArr != null) {
            try {
                ret = new ArrayList<ArrayList<String>>();
                int count = jArr.length();
                for (int i = 0; i < count; i++) {
                    ArrayList<String> item = new ArrayList<String>();
                    JSONObject obj = jArr.getJSONObject(i);
                    for (String iter : params) {
                        item.add(obj.getString(iter));
                    }
                    ret.add(item);
                }
            } catch (Exception ex) {
                Log.e(TAG, errorLog);
                ex.printStackTrace();
            }
        }
        return ret;
    }

    public long doLong(String wsUrl, String errorLog) {
        long kq = 0;
        HttpClient client = new DefaultHttpClient();
        wsUrl = wsUrl.replace(" ", "%20");
        System.out.println("getWSAsString:" + wsUrl);
        try {
            HttpPost post = new HttpPost(wsUrl);
            post.setHeader("Authorization", Common.AUTHORIZE_STRING);
            HttpResponse response = client.execute(post);
            HttpEntity entity = response.getEntity();
            if (entity != null) {
                InputStream is = entity.getContent();
                String ret = Helper.toString(is).trim();
                kq = Long.parseLong(ret);
            }
        } catch (Exception ex) {
            Log.e(TAG, errorLog);
            ex.printStackTrace();
        }
        return kq;
    }
//	public long doLongPOST(String wsUrl, String merchantId, String firstName, String lastName, String middleName, 
//			String inputStr, String imageType, String email, String phone, String address, String birthday, String sex, String errorLog){
//		long kq = 0;
//		HttpClient client = new DefaultHttpClient();
//		try{
//			HttpPost post = new HttpPost(wsUrl);
//			post.setHeader("Authorization",Common.AUTHORIZE_STRING);
//			
//			List<NameValuePair> nameValuePairs = new ArrayList<NameValuePair>(15);
//			nameValuePairs.add(new BasicNameValuePair("merchantId", merchantId));
//			nameValuePairs.add(new BasicNameValuePair("firstName", firstName));
//			nameValuePairs.add(new BasicNameValuePair("lastName", lastName));
//			nameValuePairs.add(new BasicNameValuePair("middleName", middleName));
//			nameValuePairs.add(new BasicNameValuePair("inputStr", inputStr));
//			nameValuePairs.add(new BasicNameValuePair("imageType", imageType));
//			nameValuePairs.add(new BasicNameValuePair("email", email));
//			nameValuePairs.add(new BasicNameValuePair("phone", phone));
//			nameValuePairs.add(new BasicNameValuePair("address", address));
//			nameValuePairs.add(new BasicNameValuePair("birthday", birthday));
//			nameValuePairs.add(new BasicNameValuePair("sex", sex));
//			nameValuePairs.add(new BasicNameValuePair("userId", ApplicationConfig.userId));
//			nameValuePairs.add(new BasicNameValuePair("groupId", ApplicationConfig.groupdId));
//			nameValuePairs.add(new BasicNameValuePair("companyId", ApplicationConfig.companyId));
//			nameValuePairs.add(new BasicNameValuePair("status", "0"));
//			post.setEntity(new UrlEncodedFormEntity(nameValuePairs));
//			
//			HttpResponse response = client.execute(post);
//			HttpEntity entity = response.getEntity();
//			if(entity != null){
//				InputStream is = entity.getContent();
//				String ret = Helper.toString(is).trim();	
//				kq = Long.parseLong(ret);
//			}
//		}
//		catch(Exception ex){
//			Log.e(TAG, errorLog);
//			ex.printStackTrace();
//		}
//		return kq;
//	}

    public long doLongPOST(String wsUrl, String errorLog, List<NameValuePair> nameValuePairs) {
        long kq = 0;
        HttpClient client = new DefaultHttpClient();
        System.out.println("WsURl:" + wsUrl);
        try {
            HttpPost post = new HttpPost(wsUrl);
            post.setHeader("Authorization", Common.AUTHORIZE_STRING);

            post.setEntity(new UrlEncodedFormEntity(nameValuePairs));

            HttpResponse response = client.execute(post);
            HttpEntity entity = response.getEntity();
            if (entity != null) {
                InputStream is = entity.getContent();
                String ret = Helper.toString(is).trim();
                System.out.println("ket qua ret:" + ret);
                kq = Long.parseLong(ret);
            }
        } catch (Exception ex) {
            Log.e(TAG, errorLog);
            ex.printStackTrace();
        }
        return kq;
    }

    //	public long doLongPOSTAdd(String wsUrl, String merchantId, String firstName, String lastName, String middleName,
//			String inputStr, String imageType, String email, String phone, String address, String birthday, String sex, String errorLog){
//		long kq = 0;
//		HttpClient client = new DefaultHttpClient();
//		try{
//			HttpPost post = new HttpPost(wsUrl);
//			post.setHeader("Authorization",Common.AUTHORIZE_STRING);
//			
//			List<NameValuePair> nameValuePairs = new ArrayList<NameValuePair>(15);
//			nameValuePairs.add(new BasicNameValuePair("merchantId", merchantId));
//			nameValuePairs.add(new BasicNameValuePair("firstName", firstName));
//			nameValuePairs.add(new BasicNameValuePair("lastName", lastName));
//			nameValuePairs.add(new BasicNameValuePair("middleName", middleName));
//			nameValuePairs.add(new BasicNameValuePair("inputStr", inputStr));
//			nameValuePairs.add(new BasicNameValuePair("imageType", imageType));
//			nameValuePairs.add(new BasicNameValuePair("email", email));
//			nameValuePairs.add(new BasicNameValuePair("phone", phone));
//			nameValuePairs.add(new BasicNameValuePair("address", address));
//			nameValuePairs.add(new BasicNameValuePair("birthday", birthday));
//			nameValuePairs.add(new BasicNameValuePair("sex", sex));
//			nameValuePairs.add(new BasicNameValuePair("userId", ApplicationConfig.userId));
//			nameValuePairs.add(new BasicNameValuePair("groupId", ApplicationConfig.groupdId));
//			nameValuePairs.add(new BasicNameValuePair("companyId", ApplicationConfig.companyId));
//			nameValuePairs.add(new BasicNameValuePair("status", "0"));
//			post.setEntity(new UrlEncodedFormEntity(nameValuePairs));
//			
//			HttpResponse response = client.execute(post);
//			HttpEntity entity = response.getEntity();
//			if(entity != null){
//				InputStream is = entity.getContent();
//				String ret = Helper.toString(is).trim();	
//				kq = Long.parseLong(ret);
//			}
//		}
//		catch(Exception ex){
//			Log.e(TAG, errorLog);
//			ex.printStackTrace();
//		}
//		return kq;
//	}
//	public long doLongPOSTEdit(String wsUrl, String merchantId, String firstName, String lastName, String middleName, 
//			String inputStr, String imageType, String email, String phone, String address, String birthday, String sex, String errorLog){
//		long kq = 0;
//		HttpClient client = new DefaultHttpClient();
//		try{
//			HttpPost post = new HttpPost(wsUrl);
//			post.setHeader("Authorization",Common.AUTHORIZE_STRING);
//			
//			List<NameValuePair> nameValuePairs = new ArrayList<NameValuePair>(15);
//			nameValuePairs.add(new BasicNameValuePair("merchantId", merchantId));
//			nameValuePairs.add(new BasicNameValuePair("firstName", firstName));
//			nameValuePairs.add(new BasicNameValuePair("lastName", lastName));
//			nameValuePairs.add(new BasicNameValuePair("middleName", middleName));
//			nameValuePairs.add(new BasicNameValuePair("inputStr", inputStr));
//			nameValuePairs.add(new BasicNameValuePair("imageType", imageType));
//			nameValuePairs.add(new BasicNameValuePair("email", email));
//			nameValuePairs.add(new BasicNameValuePair("phone", phone));
//			nameValuePairs.add(new BasicNameValuePair("address", address));
//			nameValuePairs.add(new BasicNameValuePair("birthday", birthday));
//			nameValuePairs.add(new BasicNameValuePair("sex", sex));
//			nameValuePairs.add(new BasicNameValuePair("userId", Common.userId));
//			nameValuePairs.add(new BasicNameValuePair("groupId", Common.groupdId));
//			nameValuePairs.add(new BasicNameValuePair("companyId", Common.companyId));
//			nameValuePairs.add(new BasicNameValuePair("status", "0"));
//			post.setEntity(new UrlEncodedFormEntity(nameValuePairs));
//			
//			HttpResponse response = client.execute(post);
//			HttpEntity entity = response.getEntity();
//			if(entity != null){
//				InputStream is = entity.getContent();
//				String ret = Helper.toString(is).trim();	
//				kq = Long.parseLong(ret);
//			}
//		}
//		catch(Exception ex){
//			Log.e(TAG, errorLog);
//			ex.printStackTrace();
//		}
//		return kq;
//	}
    public boolean doBoolean(String wsUrl, String errorLog) {
        boolean kq = false;
        HttpClient client = new DefaultHttpClient();
        wsUrl = wsUrl.replace(" ", "%20");
        System.out.println("getWSAsString:" + wsUrl);
        try {
            HttpPost post = new HttpPost(wsUrl);
            post.setHeader("Authorization", Common.AUTHORIZE_STRING);
            HttpResponse response = client.execute(post);
            HttpEntity entity = response.getEntity();
            if (entity != null) {
                InputStream is = entity.getContent();
                String ret = Helper.toString(is).trim();
                kq = Boolean.parseBoolean(ret);
            }
        } catch (Exception ex) {
            Log.e(TAG, errorLog);
            ex.printStackTrace();
        }
        return kq;
    }

    public String doStringPost(String wsUrl, String errorLog, List<NameValuePair> listParams) {
        String kq = "";
        HttpClient client = new DefaultHttpClient();
        wsUrl = wsUrl.replace(" ", "%20");
        System.out.println("getWSAsString:" + wsUrl);
        try {
            HttpPost post = new HttpPost(wsUrl);
            post.setHeader("Authorization", Common.AUTHORIZE_STRING);
            post.setEntity(new UrlEncodedFormEntity(listParams));
            HttpResponse response = client.execute(post);
            HttpEntity entity = response.getEntity();
            if (entity != null) {
                InputStream is = entity.getContent();
                kq = Helper.toString(is).trim();
                if (kq.startsWith("\""))
                    kq = kq.substring(1);
                if (kq.endsWith("\""))
                    kq = kq.substring(0, kq.length() - 1);

                Log.e("kq doStringPost", kq);

            }
        } catch (Exception ex) {
            Log.e(TAG, errorLog);
            ex.printStackTrace();
        }
        return kq;
    }

    public String doStringPOST(String wsUrl, String errorLog, List<NameValuePair> listParams) {
        String kq = "";
        HttpClient client = new DefaultHttpClient();
        wsUrl = wsUrl.replace(" ", "%20");
        System.out.println("getWSAsString:" + wsUrl);
        try {
            HttpPost post = new HttpPost(wsUrl);
            post.setHeader("Authorization", Common.AUTHORIZE_STRING);
            post.setEntity(new UrlEncodedFormEntity(listParams));
            HttpResponse response = client.execute(post);
            HttpEntity entity = response.getEntity();
            if (entity != null) {
                InputStream is = entity.getContent();
                kq = Helper.toString(is).trim();
                System.out.println("kq doStringPost:" + kq);
            }
        } catch (Exception ex) {
            Log.e(TAG, errorLog);
            ex.printStackTrace();
        }
        return kq;
    }

    public void doPost(String wsUrl, String errorLog, List<NameValuePair> listParams) {
        HttpClient client = new DefaultHttpClient();
        wsUrl = wsUrl.replace(" ", "%20");
        System.out.println("getWSAsString:" + wsUrl);
        try {
            HttpPost post = new HttpPost(wsUrl);
            post.setHeader("Authorization", Common.AUTHORIZE_STRING);
            post.setEntity(new UrlEncodedFormEntity(listParams));
            client.execute(post);
        } catch (Exception ex) {
            Log.e(TAG, errorLog);
            ex.printStackTrace();
        }
    }

    public JSONObject doPostObjectPOST(String wsUrl, String errorLog, String strJason) {
        JSONObject ret = null;
        HttpClient client = new DefaultHttpClient();
        wsUrl = wsUrl.replace(" ", "%20");
        try {

            HttpPost post = new HttpPost(wsUrl);
            post.setHeader("Authorization", Common.AUTHORIZE_STRING);
            // Set HTTP parameters
            post.setHeader("Accept", "application/json");
            post.setHeader("Content-type", "application/json");
            StringEntity se = new StringEntity(strJason);
            post.setEntity(se);

            HttpResponse response = client.execute(post);
            HttpEntity entity = response.getEntity();
            if (entity != null) {
                InputStream is = entity.getContent();
                String str = Helper.toString(is).trim();
                System.out.println("chuoi str:" + str);
                ret = new JSONObject(str);
                is.close();
            }
        } catch (Exception ex) {
            Log.e(TAG, errorLog);
            ex.printStackTrace();
        }
        return ret;
    }
    public HttpClient getNewHttpClient() {
        try {
            KeyStore trustStore = KeyStore.getInstance(KeyStore.getDefaultType());
            trustStore.load(null, null);

            MySSLSocketFactory sf = new MySSLSocketFactory(trustStore);
            sf.setHostnameVerifier(SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);

            HttpParams params = new BasicHttpParams();
            HttpProtocolParams.setVersion(params, HttpVersion.HTTP_1_1);
            HttpProtocolParams.setContentCharset(params, HTTP.UTF_8);

            SchemeRegistry registry = new SchemeRegistry();
            registry.register(new Scheme("http", PlainSocketFactory.getSocketFactory(), 80));
            registry.register(new Scheme("https", sf, 443));

            ClientConnectionManager ccm = new ThreadSafeClientConnManager(params, registry);

            return new DefaultHttpClient(ccm, params);
        } catch (Exception e) {
            return new DefaultHttpClient();
        }
    }

    public int doGetIntPOST_Metropole(String wsUrl, String errorLog, List<NameValuePair> nameValuePairs) {
        int ret = 0;
        HttpClient client = getNewHttpClient();
        wsUrl = wsUrl.replace(" ", "%20");
        try {
            HttpPost post = new HttpPost(wsUrl);
            post.setHeader("Content-Type", "application/x-www-form-urlencoded");
            post.setEntity(new UrlEncodedFormEntity(nameValuePairs));

            HttpResponse response = client.execute(post);
            HttpEntity entity = response.getEntity();
            if (entity != null) {
                InputStream is = entity.getContent();
                String str = Helper.toString(is).trim();
                System.out.println("chuoi str:" + str);
                ret = Integer.parseInt(str);
                is.close();
            }
        } catch (Exception ex) {
            Log.e(TAG, errorLog);
            ex.printStackTrace();
        }
        return ret;
    }
//    public int uploadFile(String sourceFileUri) {
//Â Â Â Â Â Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â Â String fileName = sourceFileUri;
//Â Â 
//Â Â Â Â Â Â Â Â Â Â HttpURLConnection conn = null;
//Â Â Â Â Â Â Â Â Â Â DataOutputStream dos = null;Â 
//Â Â Â Â Â Â Â Â Â Â String lineEnd = "\r\n";
//Â Â Â Â Â Â Â Â Â Â String twoHyphens = "--";
//Â Â Â Â Â Â Â Â Â Â String boundary = "*****";
//Â Â Â Â Â Â Â Â Â Â int bytesRead, bytesAvailable, bufferSize;
//Â Â Â Â Â Â Â Â Â Â byte[] buffer;
//Â Â Â Â Â Â Â Â Â Â int maxBufferSize = 1 * 1024 * 1024;
//Â Â Â Â Â Â Â Â Â Â File sourceFile = new File(sourceFileUri);
//Â Â Â Â Â Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â Â if (!sourceFile.isFile()) {
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Log.e("uploadFile", "Source File not exist :"+uploadFilePath );
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â return 0;
//Â Â Â Â Â Â Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â Â }
//Â Â Â Â Â Â Â Â Â Â else
//Â Â Â Â Â Â Â Â Â Â {
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â try {
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // open a URL connection to the Servlet
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â FileInputStream fileInputStream = new FileInputStream(sourceFile);
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â URL url = new URL(upLoadServerUri);
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // Open a HTTPÂ  connection toÂ  the URL
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â conn = (HttpURLConnection) url.openConnection();
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â conn.setDoInput(true); // Allow Inputs
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â conn.setDoOutput(true); // Allow Outputs
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â conn.setUseCaches(false); // Don't use a Cached Copy
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â conn.setRequestMethod("POST");
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â conn.setRequestProperty("Connection", "Keep-Alive");
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â conn.setRequestProperty("ENCTYPE", "multipart/form-data");
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â conn.setRequestProperty("Content-Type", "multipart/form-data;boundary=" + boundary);
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â conn.setRequestProperty("uploaded_file", fileName);
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â dos = new DataOutputStream(conn.getOutputStream());
//Â Â Â Â Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â dos.writeBytes(twoHyphens + boundary + lineEnd);
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â dos.writeBytes("Content-Disposition: form-data; name="uploaded_file";filename=""
//                        Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â + fileName + """ + lineEnd);
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â dos.writeBytes(lineEnd);
//Â Â Â Â Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // create a buffer ofÂ  maximum size
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â bytesAvailable = fileInputStream.available();
//Â Â Â Â Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â bufferSize = Math.min(bytesAvailable, maxBufferSize);
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â buffer = new byte[bufferSize];
//Â Â Â Â Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // read file and write it into form...
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â bytesRead = fileInputStream.read(buffer, 0, bufferSize);Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â while (bytesRead > 0) {
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â dos.write(buffer, 0, bufferSize);
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â bytesAvailable = fileInputStream.available();
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â bufferSize = Math.min(bytesAvailable, maxBufferSize);
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â bytesRead = fileInputStream.read(buffer, 0, bufferSize);Â Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
//Â Â Â Â Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // send multipart form data necesssary after file data...
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â dos.writeBytes(lineEnd);
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â dos.writeBytes(twoHyphens + boundary + twoHyphens + lineEnd);
//Â Â Â Â Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // Responses from the server (code and message)
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â serverResponseCode = conn.getResponseCode();
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â String serverResponseMessage = conn.getResponseMessage();
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Log.i("uploadFile", "HTTP Response is : "
//                        Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â + serverResponseMessage + ": " + serverResponseCode);
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â if(serverResponseCode == 200){
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â runOnUiThread(new Runnable() {
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â public void run() {
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â String msg = "File Upload Completed.\n\n See uploaded file here : \n\n"
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â +" http://www.androidexample.com/media/uploads/"
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â +uploadFileName;
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â messageText.setText(msg);
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Toast.makeText(UploadToServer.this, "File Upload Complete.",
//                                    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Toast.LENGTH_SHORT).show();
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â });Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â Â Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //close the streams //
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â fileInputStream.close();
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â dos.flush();
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â dos.close();
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â } catch (MalformedURLException ex) {
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â dialog.dismiss();Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ex.printStackTrace();
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â runOnUiThread(new Runnable() {
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â public void run() {
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â messageText.setText("MalformedURLException Exception : check script url.");
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Toast.makeText(UploadToServer.this, "MalformedURLException",
//                                Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Toast.LENGTH_SHORT).show();
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â });
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Log.e("Upload file to server", "error: " + ex.getMessage(), ex);Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â } catch (Exception e) {
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â dialog.dismiss();Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â e.printStackTrace();
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â runOnUiThread(new Runnable() {
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â public void run() {
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â messageText.setText("Got Exception : see logcat ");
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Toast.makeText(UploadToServer.this, "Got Exception : see logcat ",
//                                Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Toast.LENGTH_SHORT).show();
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â });
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Log.e("Upload file to server Exception", "Exception : "
//                        Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â + e.getMessage(), e);Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â dialog.dismiss();Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â return serverResponseCode;
//Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
//Â Â Â Â Â Â Â Â Â Â Â } // End else block
//Â Â Â Â Â Â Â Â Â }
public String doUploadPOST(String wsUrl, String errorLog, MultipartEntity nameValuePairs) {
    String ret = "";
    HttpParams params = new BasicHttpParams();
    params.setParameter(CoreProtocolPNames.PROTOCOL_VERSION, HttpVersion.HTTP_1_1);
    HttpClient client = new DefaultHttpClient(params);
    System.out.println("WsURl:" + wsUrl);
    try {
        HttpPost post = new HttpPost(wsUrl);
//            post.setHeader("Authorization", Common.AUTHORIZE_STRING);
        post.setEntity(nameValuePairs);
        HttpResponse response = client.execute(post);
        HttpEntity entity = response.getEntity();
        if (entity != null) {
            InputStream is = entity.getContent();
            String str = Helper.toString(is).trim();
//                ret = Long.parseLong(str);
            System.out.println(str);
           return str;

        }
        client.getConnectionManager().shutdown();
    } catch (Exception ex) {
        Log.e(TAG, errorLog);
        ex.printStackTrace();
    }
    return ret;
}
}
